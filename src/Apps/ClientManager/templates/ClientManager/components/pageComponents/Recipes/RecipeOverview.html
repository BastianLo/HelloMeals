{% load i18n %}
<div style="position: absolute; left:20px;right:20px;" x-data="{
  currentPage: '',
  store: {
    params: {
        filter: {
            sources: [],
            ingredients: [],
            tags: [],
            recipeType: null,
            favorited: null,
            isPlus: null,
        },
        ordering: null,
        take: 1,
        page: 1,
        pageSize: 24,
        searchString: '',
        fields: ['name', 'headline', 'averageRating', 'ratingCount', 'image', 'source', 'helloFreshId', 'healthScore', 'nutrients', 'favorited', 'ingredient_count', 'available_ingredient_count', 'isPlus'],
        recipeTypes: [{name: 'Hauptgerichte', id: 0},{name: 'Frühstück', id: 1},{name: 'Dessert', id: 2},{name: 'Backen', id: 3},{name: 'Getränke', id: 4},]
    },
    tag_groups: [],
    show: false,
    recipes: [],
    nav: {},
    initialized: false,
    loading: false,
    sliders: {
        nutrients:[
            {
                keyword: 'calories',
                title: 'Kalorien',
                element: null,
                min: null,
                max: null,
                borderMin: 0,
                borderMax: 2000
            },
            {
                keyword: 'protein',
                title: 'Protein',
                element: null,
                min: null,
                max: null,
                borderMin: 0,
                borderMax: 200
            },
            {
                keyword: 'carbs',
                title: 'Kohlenhydrate',
                element: null,
                min: null,
                max: null,
                borderMin: 0,
                borderMax: 200
            },
            {
                keyword: 'fat',
                title: 'Fett',
                element: null,
                min: null,
                max: null,
                borderMin: 0,
                borderMax: 200
            },
        ]
    },
    parseUrlParams(){
        const urlParams = new URLSearchParams(window.location.search);
        this.params.searchString = urlParams.get('srch') || '';
        this.params.page = urlParams.get('page') || 1;
        this.params.pageSize = urlParams.get('page_size') || 24;
        this.params.filter.sources = (urlParams.get('source') || '').split(',')
        this.params.filter.ingredients = (urlParams.get('ingredients') || '').split(',')
        this.params.filter.tags = (urlParams.get('tags') || '').split(',')
        this.sliders.nutrients.forEach(s => {s.min = (urlParams.get(`${s.keyword}_gt`) || s.borderMin);s.max = (urlParams.get(`${s.keyword}_lt`) || s.borderMax);})
        this.params.filter.recipeType = urlParams.get('recipeType')
        this.params.filter.isPlus = urlParams.get('isPlus') === 'true'
        this.params.ordering = this.params.ordering === null ? (urlParams.get('ordering') || 'relevancy') : this.params.ordering

    },
    parseParameters(){
        let filter = '?ordering=' + this.params.ordering
        if (this.params.searchString !== '')
            filter += '&srch=' + this.params.searchString
        filter += '&page_size=' + this.params.pageSize
        filter += '&page=' + this.params.page
        if (this.params.filter.favorited !== null)
            filter += '&favorited=' + this.params.filter.favorited
        if (this.params.filter.isPlus === true)
            filter += '&isPlus=' + this.params.filter.isPlus
        if (this.params.filter.recipeType !== null)
            filter += '&recipeType=' + this.params.filter.recipeType
        if (this.params.filter.sources.filter(s => s !== '').length > 0)
            filter += '&source=' + this.params.filter.sources.filter(s => s !== '').join(',')
        if (this.params.filter.ingredients.filter(s => s !== '').length > 0)
            filter += '&ingredients=' + this.params.filter.ingredients.filter(s => s !== '').join(',')
        if (this.params.filter.tags.filter(s => s !== '').length > 0)
            filter += '&tags=' + this.params.filter.tags.filter(t => t !== '').join('_')
        filter += '&query={' + this.params.fields.join(',') + '}'
        this.sliders.nutrients.forEach(s => {
            if (s.min !== null && s.min !== s.element.min()){
                filter += `&${s.keyword}_gt=` + s.min;
            }
            if (s.max !== null && s.max !== s.element.max()){
                filter += `&${s.keyword}_lt=` + s.max;
            }
        })
        this.addParameterToURL(filter)
        return filter
    },
    getTagFilter(){
        filters = []
         this.tag_groups.forEach(tg => {
            filters.push(tg.tags.filter(t => t.temp).map(t => t.helloFreshId).join('_'))
        })
        filters = filters.filter(t => t != '').join('@')
        if (filters === ''){return ''}
        return '&tags=' + filters
    },
    async getRecipes(params, keepImagesLoaded) {
        if (params === undefined){params = ''}
        await this.requestRecipe(`/api/Recipe${params}`, keepImagesLoaded)
    },
    async requestRecipe(url, keepImagesLoaded=false){
        this.loading = true;
        const urlParams = new URLSearchParams(url);
        this.params.page = urlParams.get('page') ? urlParams.get('page') : 1;
        let temp = await (await fetch(url)).json();
        tempRecipes = this.recipes
        temp.results.forEach(function (recipe, i) {
            if (keepImagesLoaded) {recipe.shown = tempRecipes[i].shown}
            else {recipe.shown = i<=4}
        });
        this.recipes = temp.results
        this.nav = temp
        delete this.nav.results
        this.parseParameters()
        this.loading = false;
    },
    async getTagGroups(){
        this.loading = true;
        let temp = await (await fetch('/api/Tag/Full' ) ).json();
        this.tag_groups = temp.results
        this.loading = false;
    },
    initSliders(){
        this.sliders.nutrients.forEach(s =>{
            s.element = rangeSlider(document.querySelector(`#${s.keyword}Slider`), {
                value: [s.min, s.max],
                min: s.borderMin,
                max: s.borderMax,
                onInput: (value) => {
                    s.min = value[0];
                    s.max = value[1];
                }
            })
        })
    },
    getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    },
    async setFavorite(recipeId, favorite){
        await (await fetch(`/api/Recipe/${recipeId}/favorite/${favorite}`, {method: 'POST', headers: {'X-CSRFToken': this.getCookie('csrftoken')}} ) ).json();
        await this.getRecipes(this.parseParameters(), true)
    },
    async init() {
        await this.getTagGroups()
        await this.parseUrlParams()
        this.initSliders()
        await this.getRecipes(this.parseParameters())
    },
    addParameterToURL(paramsString){
    _url = location.href.split('?')[0] + paramsString;
    history.pushState({}, null, _url);
    },
    clearFilter() {history.pushState({}, null, location.href.split('?')[0]);this.parseUrlParams(); this.initSliders() },
    async search(){this.params.page=1;await this.getRecipes(this.parseParameters())},
    async next() {
        if (this.nav.next){
            await this.requestRecipe(this.nav.next);
            window.scrollTo({ top: 0});
            }
        },
    async previous() {
        if (this.nav.previous){
            await this.requestRecipe(this.nav.previous);
            window.scrollTo({ top: 0 });
        }
    },

    cutoff(text, limit)
    {
        if (text === null){return text}
        if(text.length - 3 > limit){
            return text.substring(0, limit - 3) + '...';
        }
        else{
            return text
        }
    }
  }
}">
    {% block store %}
        <div x-init="await store.init()">
        </div>
    {% endblock %}

    <div x-show="store.loading" class="fixed top-0 left-0 z-50 flex justify-between w-full p-4 ">
        <div class="text-center flex justify-center w-full ">
            <button disabled type="button"
                    class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 inline-flex items-center">
                <svg aria-hidden="true" role="status" class="inline w-4 h-4 mr-3 text-white animate-spin"
                     viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
                          fill="#E5E7EB"></path>
                    <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
                          fill="currentColor"></path>
                </svg>
                {% trans 'common.loading.label' %}...
            </button>
        </div>
    </div>

    <!-- Filter popup Modal -->
    <div class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="store.show">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0 mb-40">
                <div @click.outside="store.search();store.show=false" style="width: 400px"
                     class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                    <div class="w-lg shadow p-5 rounded-lg dark:bg-gray-800">
                        <!-- Popup head -->
                        <div class="flex items-center justify-between mt-4">
                            <p class="font-medium dark:text-white">
                                {% trans 'filter.label' %}
                            </p>
                            <button @click="store.search(); store.show = false"
                                    class="text-white px-4 py-2 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                                {% trans 'filter.apply' %}
                            </button>
                            <button @click="store.clearFilter(); store.search(); store.show = false"
                                    class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 text-sm font-medium rounded-md">
                                {% trans 'filter.reset' %}
                            </button>
                        </div>
                        <!-- Popup body -->
                        <div class="mt-5">
                            <div>
                                <div class="mb-5" x-data="{open: false}">
                                    <h2 id="accordion-collapse-heading-2">
                                        <button type="button"
                                                @click="open = !open"
                                                :class="{'border-b-0':open}"
                                                class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-500 border border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"
                                        >
                                            <span :class="{'dark:text-white': open}"> {% trans 'filter.nutrients.label' %} </span>
                                            <svg :class="{'rotate-180': open}" data-accordion-icon
                                                 class="w-6 h-6 shrink-0" fill="currentColor"
                                                 viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                      d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                      clip-rule="evenodd"></path>
                                            </svg>
                                        </button>
                                    </h2>
                                    <div :class="{ 'hidden': !open}" class="border dark:border-gray-700 border-t-0"
                                         aria-labelledby="accordion-collapse-heading-2">
                                        <div class="p-2 rounded">
                                            <!-- Slider Calories -->
                                            <template x-for="slider in store.sliders.nutrients">
                                                <div class="mb-4">
                                                    <div class="flex items-center mb-4 justify-between">
                                                        <p x-text="slider.title"
                                                           class="mr-4 text-lg font-extrabold leading-none tracking-tight text-gray-900 dark:text-white">
                                                        </p>
                                                        <div class="flex items-center">
                                                      <span class="mr-2 text-lg font-extrabold leading-none tracking-tight text-gray-900 dark:text-white"
                                                            x-text="slider.min"></span>
                                                            <span class="mr-2 text-lg font-extrabold leading-none tracking-tight text-gray-900 dark:text-white">-</span>
                                                            <span class="text-lg font-extrabold leading-none tracking-tight text-gray-900 dark:text-white"
                                                                  x-text="slider.max"></span>
                                                        </div>
                                                    </div>
                                                    <div :id="`${slider.keyword}Slider`"></div>
                                                </div>

                                            </template>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sources -->
                            <div>
                                <div class="mb-5" x-data="{open: false}">
                                    <h2 id="accordion-collapse-heading-2">
                                        <button type="button"
                                                @click="open = !open"
                                                :class="{'border-b-0':open}"
                                                class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-500 border border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"
                                        >
                                            <span :class="{'dark:text-white': open}"> {% trans 'filter.source.label' %} </span>
                                            <svg :class="{'rotate-180': open}" data-accordion-icon
                                                 class="w-6 h-6 shrink-0" fill="currentColor"
                                                 viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                      d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                      clip-rule="evenodd"></path>
                                            </svg>
                                        </button>
                                    </h2>
                                    <div :class="{ 'hidden': !open}" class="border dark:border-gray-700 border-t-0"
                                         aria-labelledby="accordion-collapse-heading-2">
                                        <div class="p-2 rounded">
                                            <div class="grid grid-cols-1">
                                                <div class="flex items-center">
                                                    <label>
                                                        <input type="checkbox" value="1"
                                                               class="w-4 h-4 rounded focus:ring-2"
                                                               x-model="store.params.filter.sources"
                                                        />
                                                    </label>
                                                    <p class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white">
                                                        HelloFresh</p>
                                                </div>
                                                <div class="flex items-center">
                                                    <label>
                                                        <input type="checkbox" value="2"
                                                               class="w-4 h-4 rounded focus:ring-2"
                                                               x-model="store.params.filter.sources"
                                                        />
                                                    </label>
                                                    <p class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white">
                                                        Kitchenstories</p>
                                                </div>
                                                <div class="flex items-center">
                                                    <label>
                                                        <input type="checkbox" value="3"
                                                               class="w-4 h-4 rounded focus:ring-2"
                                                               x-model="store.params.filter.sources"
                                                        />
                                                    </label>
                                                    <p class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white">
                                                        Chefkoch</p>
                                                </div>
                                                <div class="flex items-center">
                                                    <label>
                                                        <input type="checkbox" value="4"
                                                               class="w-4 h-4 rounded focus:ring-2"
                                                               x-model="store.params.filter.sources"
                                                        />
                                                    </label>
                                                    <p class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white">
                                                        Lecker</p>
                                                </div>
                                                <div class="flex items-center">
                                                    <label>
                                                        <input type="checkbox" value="5"
                                                               class="w-4 h-4 rounded focus:ring-2"
                                                               x-model="store.params.filter.sources"
                                                        />
                                                    </label>
                                                    <p class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white">
                                                        EatSmarter</p>
                                                </div>
                                                <div class="flex items-center">
                                                    <label>
                                                        <input type="checkbox" value="6"
                                                               class="w-4 h-4 rounded focus:ring-2"
                                                               x-model="store.params.filter.sources"
                                                        />
                                                    </label>
                                                    <p class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white">
                                                        Yazio</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="mb-5" x-data="{open: false}">
                                    <h2 id="accordion-collapse-heading-2">
                                        <button type="button"
                                                @click="open = !open"
                                                :class="{'border-b-0':open}"
                                                class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-500 border border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"
                                        >
                                            <span :class="{'dark:text-white': open}"> {% trans 'filter.recipeType.label' %} </span>
                                            <svg :class="{'rotate-180': open}" data-accordion-icon
                                                 class="w-6 h-6 shrink-0" fill="currentColor"
                                                 viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                      d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                      clip-rule="evenodd"></path>
                                            </svg>
                                        </button>
                                    </h2>
                                    <div :class="{ 'hidden': !open}" class="border dark:border-gray-700 border-t-0"
                                         aria-labelledby="accordion-collapse-heading-2">
                                        <div class="p-2 rounded">
                                            <div class="grid grid-cols-1">
                                                <template x-for="t in store.params.recipeTypes" :key="t.id">
                                                    <div>
                                                        <input x-model="store.params.filter.recipeType" type="radio"
                                                               :value="t.id.toString()" :id="t.name">
                                                        <label class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white"
                                                               :for="t.name" x-text="t.name"></label>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recipe Properties -->
                            <div>
                                <div class="mb-5" x-data="{open: false}">
                                    <h2 id="accordion-collapse-heading-2">
                                        <button type="button"
                                                @click="open = !open"
                                                :class="{'border-b-0':open}"
                                                class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-500 border border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"
                                        >
                                            <span :class="{'dark:text-white': open}"> {% trans 'filter.properties.label' %} </span>
                                            <svg :class="{'rotate-180': open}" data-accordion-icon
                                                 class="w-6 h-6 shrink-0" fill="currentColor"
                                                 viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                      d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                      clip-rule="evenodd"></path>
                                            </svg>
                                        </button>
                                    </h2>
                                    <div :class="{ 'hidden': !open}" class="border dark:border-gray-700 border-t-0"
                                         aria-labelledby="accordion-collapse-heading-2">
                                        <div class="p-2 rounded">
                                            <div class="grid grid-cols-1">
                                                <div class="flex items-center">
                                                    <label>
                                                        <input type="checkbox" value="1"
                                                               class="w-4 h-4 rounded focus:ring-2"
                                                               x-model="store.params.filter.isPlus"
                                                        />
                                                    </label>
                                                    <p class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white">
                                                        Chefkoch Plus</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Categories -->
                            <div>
                                <p class="text-3xl dark:text-white mb-2 mt-2">
                                    {% trans 'filter.categories.label' %}
                                </p>
                                <template x-for="tagGroup in store.tag_groups">
                                    <div class="mb-5" x-data="{open: false}">
                                        <h2 id="accordion-collapse-heading-2">
                                            <button type="button"
                                                    @click="open = !open"
                                                    :class="{'border-b-0':open}"
                                                    class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-500 border border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"
                                            >
                                                <span :class="{'dark:text-white': open}" x-text="tagGroup.name"></span>
                                                <svg :class="{'rotate-180': open}" data-accordion-icon
                                                     class="w-6 h-6 shrink-0" fill="currentColor"
                                                     viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd"
                                                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                          clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </h2>
                                        <div :class="{ 'hidden': !open}" class="border dark:border-gray-700 border-t-0"
                                             aria-labelledby="accordion-collapse-heading-2">
                                            <div class="p-2 rounded">
                                                <div class="grid grid-cols-2">
                                                    <template x-for="tag in tagGroup.tags">
                                                        <div class="flex items-center">
                                                            <label>
                                                                <input type="checkbox" :value="tag.helloFreshId"
                                                                       class="w-4 h-4 rounded focus:ring-2"
                                                                       x-model="store.params.filter.tags"
                                                                />
                                                            </label>
                                                            <p x-text="tag.name"
                                                               class="w-full ml-2 text-sm font-medium text-gray-900 rounded dark:text-white"></p>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Filter button and Searchbox -->
    <div class="mt-5 mb-5 flex flex-row flex justify-center ">
        <button class="p-1 mr-4" @click="store.show = !store.show">
            <svg class="w-6 h-6 mb-1 text-gray-500 dark:text-gray-400" aria-hidden="true" fill="currentColor"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path clip-rule="evenodd"
                      d="M2.628 1.601C5.028 1.206 7.49 1 10 1s4.973.206 7.372.601a.75.75 0 01.628.74v2.288a2.25 2.25 0 01-.659 1.59l-4.682 4.683a2.25 2.25 0 00-.659 1.59v3.037c0 .684-.31 1.33-.844 1.757l-1.937 1.55A.75.75 0 018 18.25v-5.757a2.25 2.25 0 00-.659-1.591L2.659 6.22A2.25 2.25 0 012 4.629V2.34a.75.75 0 01.628-.74z"
                      fill-rule="evenodd"></path>
            </svg>
        </button>
        <label for="default-search"
               class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">{% trans 'search' %}</label>
        <div x-data="{searchString: ''}" class="relative" style="width: 400px">
            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none"
                     stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
            <input type="search" id="default-search" @keyup.enter="await store.search()"
                   x-model="store.params.searchString"
                   class="block w-full p-4 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                   placeholder="{% trans 'recipe.name' %}" required>
            <button type="button" @click="await store.search()"
                    class="text-white absolute right-2.5 bottom-2.5 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                {% trans 'search' %}
            </button>
        </div>
        <!-- Sort dropdown -->
        <div @click.away="show=false" x-data=" {show: false}
        " class="relative inline-block text-left">
            <div>
                <button type="button"
                        @click="show = !show"
                        class="text-white ml-2 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                        id="sort-menu" aria-expanded="false" aria-haspopup="true">
                    Sort
                    <svg class="w-4 h-4 ml-2 -mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                         fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd"
                              d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12zm-1-5a1 1 0 112 0v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1H8a1 1 0 110-2h1v-1z"
                              clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            <template x-if="show">
                <div class="origin-top-right absolute right-0 mt-2 w-40 rounded-md shadow-lg bg-white ring-1 ring-black
            ring-opacity-5"
                     role="menu" aria-orientation="vertical" aria-labelledby="sort-menu">
                    <div class="py-1" role="none">
                        <button @click="store.params.ordering='relevancy'; await store.getRecipes(store.parseParameters()); show=false"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                                role="menuitem">Relevanz
                        </button>
                        <button @click="store.params.ordering='availIngredients'; await store.getRecipes(store.parseParameters()); show=false"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                                role="menuitem">Zutaten
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Navigation -->
    <div class="flex flex-col items-center mb-24">
            <span class="text-sm text-gray-700 dark:text-gray-400">
              {% trans 'common.navigation.showing' %} <span class="font-semibold text-gray-900 dark:text-white"
                                                            x-text="store.nav.start"></span> {% trans 'common.navigation.to' %} <span
                    class="font-semibold text-gray-900 dark:text-white"
                    x-text="store.nav.end"></span> {% trans 'common.navigation.of' %} <span
                    class="font-semibold text-gray-900 dark:text-white"
                    x-text="store.nav.count"></span> {% trans 'common.navigation.entries' %}
            </span>
        <div class="inline-flex mt-2 xs:mt-0">
            <button @click="await store.previous()"
                    class="px-4 py-2 text-sm font-medium text-white bg-gray-800 rounded-l hover:bg-gray-900 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                {% trans 'common.navigation.previous' %}
            </button>
            <button @click="await store.next()"
                    class="px-4 py-2 text-sm font-medium text-white bg-gray-800 border-0 border-l border-gray-700 rounded-r hover:bg-gray-900 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                {% trans 'common.navigation.next' %}
            </button>
        </div>
    </div>
    <!-- Recipes -->
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 mx-auto mb-6 mt-10">
        <template x-for="recipe in store.recipes">
            <div class="max-w-sm bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700 flex flex-col justify-stretch">
                <a :href="recipe.helloFreshId">
                </a>
                <div x-intersect="recipe.shown = true">
                    <div class="flex flex-col relative"
                         x-show="recipe.shown" x-transition>
                        <template x-if="recipe.isPlus === true">
                            <svg class="absolute ml-2 mt-2" width="64" height="24" viewBox="0 0 64 24" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M0 8C0 3.58172 3.58172 0 8 0H56C60.4183 0 64 3.58172 64 8V16C64 20.4183 60.4183 24 56 24H8C3.58172 24 0 20.4183 0 16V8Z"
                                      fill="#734B6D"></path>
                                <path d="M55.9158 11.081H53.401V8.62203C53.4146 8.49524 53.4009 8.36707 53.361 8.24582C53.321 8.12457 53.2556 8.01295 53.169 7.9182C53.0825 7.82346 52.9768 7.7477 52.8587 7.69584C52.7405 7.64399 52.6125 7.61719 52.4832 7.61719C52.3539 7.61719 52.226 7.64399 52.1078 7.69584C51.9897 7.7477 51.884 7.82346 51.7975 7.9182C51.7109 8.01295 51.6455 8.12457 51.6055 8.24582C51.5656 8.36707 51.5519 8.49524 51.5655 8.62203V11.081H49.0507C48.9221 11.0676 48.7919 11.0811 48.6689 11.1205C48.5459 11.1599 48.4328 11.2243 48.3367 11.3096C48.2405 11.3949 48.1636 11.4991 48.111 11.6156C48.0584 11.7321 48.0312 11.8581 48.0312 11.9856C48.0312 12.1131 48.0584 12.2392 48.111 12.3556C48.1636 12.4721 48.2405 12.5763 48.3367 12.6616C48.4328 12.7469 48.5459 12.8114 48.6689 12.8507C48.7919 12.8901 48.9221 12.9036 49.0507 12.8902H51.606V15.3692C51.5925 15.496 51.6061 15.6241 51.6461 15.7454C51.686 15.8666 51.7514 15.9783 51.8379 16.073C51.9245 16.1677 52.0302 16.2435 52.1484 16.2954C52.2665 16.3472 52.3944 16.374 52.5238 16.374C52.6531 16.374 52.7811 16.3472 52.8992 16.2954C53.0174 16.2435 53.1231 16.1677 53.2096 16.073C53.2961 15.9783 53.3616 15.8666 53.4015 15.7454C53.4415 15.6241 53.4551 15.496 53.4416 15.3692V12.9102H55.9565C56.1832 12.8867 56.3931 12.7812 56.5457 12.6142C56.6983 12.4472 56.7826 12.2304 56.7826 12.0056C56.7826 11.7808 56.6983 11.564 56.5457 11.397C56.3931 11.23 56.1832 11.1245 55.9565 11.101L55.9158 11.081Z"
                                      fill="white"></path>
                                <path d="M41.2417 16.9983C40.4972 17.0072 39.7577 16.8784 39.0614 16.6185C38.7322 16.4896 38.4135 16.3358 38.1082 16.1587C38.0109 16.1049 37.9256 16.0324 37.8574 15.9454C37.7892 15.8584 37.7394 15.7588 37.711 15.6525C37.6826 15.5462 37.6762 15.4353 37.6922 15.3265C37.7082 15.2177 37.7462 15.1132 37.804 15.0192V14.9492L37.8547 14.8692C37.984 14.7018 38.1718 14.5877 38.3816 14.5489C38.5914 14.5101 38.8084 14.5495 38.9904 14.6593C39.2296 14.8089 39.4805 14.9392 39.7408 15.0492C40.2292 15.2506 40.7528 15.3559 41.2822 15.359C41.7022 15.4093 42.1266 15.3101 42.4788 15.0792C42.6024 14.983 42.7016 14.8597 42.7685 14.7192C42.8354 14.5786 42.8681 14.4247 42.8642 14.2695C42.8761 14.1132 42.8469 13.9566 42.7794 13.8148C42.7119 13.6729 42.6084 13.5506 42.4788 13.4598C42.1611 13.2559 41.8209 13.0883 41.4648 12.96L40.3391 12.5202C40.0273 12.3967 39.7256 12.2496 39.4366 12.0804C39.1506 11.9307 38.8848 11.7459 38.6457 11.5306C38.4236 11.3211 38.2416 11.074 38.1082 10.801C37.9591 10.489 37.8895 10.1459 37.9054 9.80138C37.9062 9.41357 37.9981 9.03121 38.1741 8.68434C38.35 8.33747 38.6052 8.03553 38.9195 7.80222C39.2595 7.54314 39.6443 7.34674 40.0552 7.22247C40.5124 7.0848 40.9868 7.01079 41.4648 7.00256C42.16 6.98005 42.8519 7.10622 43.4929 7.3724C43.7093 7.46157 43.9194 7.5651 44.1216 7.68227C44.2166 7.7343 44.3003 7.8044 44.3676 7.88852C44.435 7.97264 44.4847 8.0691 44.5139 8.17231C44.5432 8.27552 44.5513 8.38342 44.538 8.48976C44.5246 8.5961 44.4899 8.69877 44.436 8.7918C44.4183 8.82886 44.3943 8.86267 44.365 8.89176L44.3143 8.96173C44.1943 9.10469 44.0287 9.20329 43.8445 9.24142C43.6603 9.27955 43.4684 9.25495 43.3002 9.17164C43.1386 9.07449 42.969 8.99089 42.7932 8.92175C42.3749 8.7407 41.9215 8.652 41.4648 8.66186C41.1069 8.64889 40.7533 8.74298 40.4507 8.93175C40.3298 9.02588 40.2323 9.14591 40.1656 9.28274C40.0988 9.41956 40.0645 9.56958 40.0653 9.72141C40.0627 9.85843 40.0958 9.99383 40.1615 10.1146C40.2272 10.2354 40.3233 10.3375 40.4406 10.4111C40.7567 10.6203 41.0972 10.7914 41.4546 10.9209L42.5701 11.3207C42.925 11.4607 43.2495 11.6006 43.5842 11.7406C43.8725 11.8783 44.139 12.0568 44.3751 12.2703C44.5965 12.482 44.7754 12.733 44.9024 13.01C45.0126 13.3554 45.0505 13.7193 45.014 14.0796C45.0186 14.4842 44.9284 14.8844 44.7503 15.2491C44.5752 15.6084 44.3225 15.9256 44.0101 16.1787C43.6623 16.4583 43.2628 16.6688 42.8337 16.7984C42.3164 16.9443 41.7796 17.0117 41.2417 16.9983Z"
                                      fill="white"></path>
                                <path d="M31.0296 16.9983C30.4424 17.0092 29.8571 16.9282 29.2956 16.7584C28.7982 16.6097 28.3479 16.3378 27.9874 15.9688C27.6037 15.574 27.322 15.094 27.166 14.5694C26.9554 13.8931 26.8595 13.1873 26.8821 12.4802V8.0821C26.8821 7.81699 26.9889 7.56275 27.1791 7.37529C27.3693 7.18783 27.6272 7.08252 27.8961 7.08252H27.9976C28.2665 7.08252 28.5244 7.18783 28.7146 7.37529C28.9048 7.56275 29.0116 7.81699 29.0116 8.0821V12.6002C28.9374 13.3339 29.1277 14.07 29.5491 14.6793C29.9418 15.0507 30.465 15.2581 31.0093 15.2581C31.5536 15.2581 32.0768 15.0507 32.4696 14.6793C32.8827 14.0667 33.0689 13.3324 32.9969 12.6002V8.0821C32.9969 7.81699 33.1037 7.56275 33.2939 7.37529C33.4841 7.18783 33.742 7.08252 34.011 7.08252C34.2799 7.08252 34.5378 7.18783 34.728 7.37529C34.9182 7.56275 35.025 7.81699 35.025 8.0821V12.4802C35.0477 13.1873 34.9517 13.8931 34.7411 14.5694C34.5885 15.0911 34.3142 15.5703 33.94 15.9688C33.5901 16.3359 33.15 16.6079 32.6623 16.7584C32.1333 16.9184 31.5829 16.9992 31.0296 16.9983Z"
                                      fill="white"></path>
                                <path d="M18.333 15.9487V8.08201C18.333 7.801 18.4463 7.5315 18.6479 7.3328C18.8495 7.13409 19.1229 7.02246 19.4079 7.02246H19.5195C19.6602 7.02245 19.7995 7.04993 19.9293 7.1033C20.0592 7.15667 20.177 7.23487 20.276 7.33339C20.375 7.43192 20.4532 7.5488 20.5061 7.6773C20.5591 7.80579 20.5856 7.94335 20.5843 8.08201V15.279H24.0727C24.2932 15.279 24.5047 15.3653 24.6606 15.519C24.8166 15.6728 24.9042 15.8812 24.9042 16.0986V16.1786C24.9042 16.2862 24.8827 16.3928 24.8409 16.4923C24.7991 16.5917 24.7379 16.6821 24.6606 16.7582C24.5834 16.8343 24.4918 16.8947 24.3909 16.9359C24.29 16.9771 24.1819 16.9983 24.0727 16.9983H19.4079C19.1246 16.9983 18.8527 16.888 18.6514 16.6915C18.4501 16.4949 18.3357 16.228 18.333 15.9487Z"
                                      fill="white"></path>
                                <path d="M8.0005 15.9487V8.08203C7.99643 7.94169 8.02096 7.80198 8.07265 7.67116C8.12433 7.54034 8.20212 7.42107 8.3014 7.32042C8.40068 7.21976 8.51944 7.13975 8.65065 7.08514C8.78185 7.03053 8.92284 7.00243 9.06527 7.00248H11.8033C12.3583 7.00074 12.9121 7.05433 13.4562 7.16241C13.9289 7.26022 14.3793 7.44321 14.7846 7.70219C15.1604 7.95856 15.4668 8.30175 15.677 8.70176C15.9101 9.17071 16.0216 9.6893 16.0015 10.2111C16.0224 10.733 15.9109 11.2518 15.677 11.7205C15.4626 12.1207 15.1529 12.4637 14.7745 12.7201C14.3703 12.9986 13.9161 13.1988 13.4359 13.3098C12.9014 13.4375 12.3533 13.5013 11.8033 13.4997H10.2518V15.9287C10.2491 16.208 10.1347 16.4749 9.93337 16.6715C9.73207 16.868 9.46015 16.9783 9.17681 16.9783H9.06527C8.92529 16.9852 8.78537 16.9635 8.65434 16.9145C8.5233 16.8655 8.40399 16.7903 8.30394 16.6935C8.20389 16.5968 8.12527 16.4807 8.07304 16.3525C8.02082 16.2243 7.99611 16.0868 8.0005 15.9487ZM10.2518 11.9504H11.7019C13.1418 11.9504 13.8517 11.3906 13.8517 10.2711C13.8712 10.0442 13.8321 9.8162 13.7382 9.60823C13.6442 9.40025 13.4983 9.21908 13.3142 9.0816C12.8089 8.80993 12.2357 8.68515 11.6613 8.72176H10.2518V11.9504Z"
                                      fill="white"></path>
                            </svg>
                        </template>
                        <img style="object-fit: cover;height: 224px; width: 336px" class="rounded-t-lg"
                             :src="recipe.shown ? recipe.image : ''" alt=""/>
                    </div>
                </div>
                <div class="flex items-center mt-2 ml-2">
                    <svg aria-hidden="true" class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"
                         xmlns="http://www.w3.org/2000/svg">
                        <title>Rating star</title>
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                    </svg>
                    <p class="ml-2 text-sm font-bold text-gray-900 dark:text-white" x-text="recipe.averageRating"></p>
                    <span class="w-1 h-1 mx-1.5 bg-gray-500 rounded-full dark:bg-gray-400"></span>
                    <p class="text-sm font-medium text-gray-900 dark:text-white"
                       x-text="recipe.ratingCount + ' Bewertungen'">
                        reviews
                    </p>

                    <div class="ml-auto mr-4">
                        <button @click="await store.setFavorite(recipe.helloFreshId, !recipe.favorited)">
                            <template x-if="recipe.favorited">
                                <svg class="w-8 h-8 mb-1 text-red-400" aria-hidden="true"
                                     fill="currentColor" viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z"></path>
                                </svg>
                            </template>
                            <template x-if="!recipe.favorited">
                                <svg class="w-8 h-8 mb-1 text-gray-500 dark:text-red-400" aria-hidden="true" fill="none"

                                     stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"
                                          stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </template>
                        </button>
                    </div>
                </div>

                <div class="flex flex-wrap items-center mt-2 ml-2">
                    <template x-if="recipe.source=='1'">
                        <div>
                            <span class="bg-lime-500 text-black text-xs font-medium mr-2 px-2.5 py-0.5 rounded ">HelloFresh</span>
                        </div>
                    </template>
                    <template x-if="recipe.source=='2'">
                        <div>
                            <span class="bg-yellow-500 text-black text-xs font-medium mr-2 px-2.5 py-0.5 rounded ">KitchenStories</span>
                        </div>
                    </template>
                    <template x-if="recipe.source=='3'">
                        <div>
                            <span class="bg-green-700 text-white text-xs font-medium mr-2 px-2.5 py-0.5 rounded ">Chefkoch</span>
                        </div>
                    </template>
                    <template x-if="recipe.source=='4'">
                        <div>
                            <span class="bg-pink-700 text-white text-xs font-medium mr-2 px-2.5 py-0.5 rounded ">Lecker</span>
                        </div>
                    </template>
                    <template x-if="recipe.source=='5'">
                        <div>
                            <span class="bg-orange-600 text-white text-xs font-medium mr-2 px-2.5 py-0.5 rounded ">EatSmarter</span>
                        </div>
                    </template>
                    <template x-if="recipe.source=='6'">
                        <div>
                            <span class="bg-pink-600 text-white text-xs font-medium mr-2 px-2.5 py-0.5 rounded ">Yazio</span>
                        </div>
                    </template>
                    <template x-if="recipe.nutrients.energyKcal!==null">
                        <div>
                                <span class=" text-white text-xs font-medium mr-2 px-2.5 py-0.5 rounded"
                                      :class="{'bg-red-500': recipe.nutrients.energyKcal > 900, 'bg-green-500': recipe.nutrients.energyKcal < 700, 'bg-orange-600': recipe.nutrients.energyKcal >= 700 && recipe.nutrients.energyKcal <= 900}"
                                      x-text="recipe.nutrients.energyKcal + ' Kcal'">
                                </span>
                        </div>
                    </template>
                    <div>
                        <span class="text-white text-xs font-medium mr-2 px-2.5 py-0.5 rounded"
                              :class="{'bg-red-500': recipe.available_ingredient_count/recipe.ingredient_count === 0, 'bg-green-500': recipe.available_ingredient_count/recipe.ingredient_count > 0.5, 'bg-orange-600': recipe.available_ingredient_count/recipe.ingredient_count > 0 && recipe.available_ingredient_count/recipe.ingredient_count <= 0.5}"
                              x-text="recipe.available_ingredient_count + '/' + recipe.ingredient_count + ' Zutaten'"></span>
                    </div>
                </div>
                <div class="p-5">
                    <a :href="recipe.helloFreshId">
                        <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white"
                            x-text="recipe.name"></h5>
                    </a>
                    <p class="mb-3 font-normal text-gray-700 dark:text-gray-400"
                       x-text="store.cutoff(recipe.headline, 100)"></p>
                </div>
            </div>
        </template>
    </div>
    <!-- Navigation -->
    <div class="flex flex-col items-center mb-24">
            <span class="text-sm text-gray-700 dark:text-gray-400">
              {% trans 'common.navigation.showing' %} <span class="font-semibold text-gray-900 dark:text-white"
                                                            x-text="store.nav.start"></span> {% trans 'common.navigation.to' %} <span
                    class="font-semibold text-gray-900 dark:text-white"
                    x-text="store.nav.end"></span> {% trans 'common.navigation.of' %} <span
                    class="font-semibold text-gray-900 dark:text-white"
                    x-text="store.nav.count"></span> {% trans 'common.navigation.entries' %}
            </span>
        <div class="inline-flex mt-2 xs:mt-0">
            <button @click="await store.previous()"
                    class="px-4 py-2 text-sm font-medium text-white bg-gray-800 rounded-l hover:bg-gray-900 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                {% trans 'common.navigation.previous' %}
            </button>
            <button @click="await store.next()"
                    class="px-4 py-2 text-sm font-medium text-white bg-gray-800 border-0 border-l border-gray-700 rounded-r hover:bg-gray-900 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                {% trans 'common.navigation.next' %}
            </button>
        </div>
    </div>
</div>